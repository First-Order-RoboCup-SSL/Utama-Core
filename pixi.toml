[workspace]
name = "Utama-Core"
channels = ["https://prefix.dev/conda-forge"]
platforms = ["linux-64", "osx-arm64"]
preview = ["pixi-build"]
version = "1.8.1"

[pypi-dependencies]
lenses = ">=1.2.0"
py-trees = ">=2.3.0"

[dependencies]  # shared deps
python = "3.11.*"
numpy = "==2.0.2"
pygame = "==2.6.1"
gymnasium = "==1.0.0"
pyserial = "==3.5"
pytest = "==8.3.4"
ruff = ">=0.9.8"
pre-commit = ">=3.8.0"
hatch = ">=1.14.1,<2"
graphviz = ">=13.1.2,<14"
snakeviz = ">=2.2.2,<3"
scipy = ">=1.16.3,<2"
pandas = "==3.0.1"
rich = ">=14.2.0,<15"

[package]
name = "Utama-Core"
version = "1.8.1"

[package.build]
backend = { name = "pixi-build-python", version = "*" }

[package.host-dependencies] 
hatchling = "*"

[feature.robosim.dependencies]
python = "3.10.*"
cmake = "<3.27"
libode = ">=0.16.2,<0.17"

[feature.robosim.pypi-dependencies]
rc-robosim = "<2"
numpy = "<=2.0.2"

[tasks]
lint = "pre-commit run --all-files"
test = "pytest utama_core/tests/"
main = "python -m main"
replay = "python -m utama_core.replay.replay_player"
precommit-install = "pre-commit install && pixi run pre-commit install --hook-type pre-commit"
precommit-uninstall = "pre-commit uninstall"

[feature.proto.dependencies]
protobuf = "==3.20.2"

[feature.vmas.dependencies]
python = "3.11.*"
pytorch = ">=2.0"

[feature.vmas.pypi-dependencies]
vmas = ">=1.3.0"
pyglet = "<=1.5.27"
gym = "*"
gym-notices = "==0.0.8"
six = "*"
protobuf = "==3.20.2"

[feature.vmas.tasks]
vmas-test = "pytest utama_core/tests/vmas_simulator/ -v"

[feature.training.dependencies]
python = "3.11.*"
pytorch = ">=2.0"

[feature.training.pypi-dependencies]
vmas = ">=1.3.0"
torchrl = ">=0.5.0"
benchmarl = ">=1.0.0"
wandb = "*"
hydra-core = ">=1.3"
omegaconf = ">=2.3"
pyglet = "<=1.5.27"
gym = "*"
gym-notices = "==0.0.8"
six = "*"
protobuf = "==3.20.2"
imageio = ">=2.34"
imageio-ffmpeg = ">=0.5"

[feature.training.tasks]
train = "python -m utama_core.training.scripts.train"
evaluate = "python -m utama_core.training.scripts.evaluate"
eval-latest = "python -m utama_core.training.scripts.evaluate --latest --render --output eval.mp4"
resume = "python -m utama_core.training.scripts.train --resume"
training-test = "pytest utama_core/tests/training/ -v"
clean-training = "rm -rf outputs/ wandb/ *.gif"

[feature.training-gpu.system-requirements]
cuda = "12.0"

[feature.training-gpu.dependencies]
python = "3.11.*"

[feature.training-gpu.target.linux-64.dependencies]
pytorch-gpu = ">=2.0"

[feature.training-gpu.target.osx-arm64.dependencies]
pytorch = ">=2.0"

[feature.training-gpu.pypi-dependencies]
vmas = ">=1.3.0"
torchrl = ">=0.5.0"
benchmarl = ">=1.0.0"
wandb = "*"
hydra-core = ">=1.3"
omegaconf = ">=2.3"
pyglet = "<=1.5.27"
gym = "*"
gym-notices = "==0.0.8"
six = "*"
protobuf = "==3.20.2"
imageio = ">=2.34"
imageio-ffmpeg = ">=0.5"

[feature.training-gpu.tasks]
train = "python -m utama_core.training.scripts.train"
evaluate = "python -m utama_core.training.scripts.evaluate"
eval-latest = "python -m utama_core.training.scripts.evaluate --latest --render --output eval.mp4"
resume = "python -m utama_core.training.scripts.train --resume"
training-test = "pytest utama_core/tests/training/ -v"
clean-training = "rm -rf outputs/ wandb/ *.gif"

[environments]
default = { features = ["proto"] }
robosim = { features = ["robosim"], no-default-feature = true }
vmas = { features = ["vmas"], no-default-feature = false }
training = { features = ["training"], no-default-feature = false }
training-gpu = { features = ["training-gpu"], no-default-feature = false, solve-group = "training-gpu" }
